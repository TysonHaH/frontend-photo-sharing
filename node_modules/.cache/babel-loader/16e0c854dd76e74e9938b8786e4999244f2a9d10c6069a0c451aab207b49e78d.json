{"ast":null,"code":"const BASE_URL = 'http://localhost:8081';\nfunction request(url, method, data = null) {\n  const headers = {\n    'Content-Type': 'application/json'\n  };\n  const config = {\n    method: method,\n    headers: headers,\n    credentials: 'include' // Quan trọng: Cho phép gửi cookie session đi kèm\n  };\n\n  // Nếu có body và method không phải là GET/HEAD, thêm body vào config\n  if (data && method !== 'GET' && method !== 'HEAD') {\n    config.body = JSON.stringify(data);\n  }\n  return fetch(BASE_URL + url, config).then(async response => {\n    // 1. Cố gắng lấy data JSON, nếu backend không trả JSON (ví dụ lỗi 500 html) thì gán là null hoặc object rỗng\n    let responseData = null;\n    try {\n      responseData = await response.json();\n    } catch (e) {\n      responseData = null;\n    }\n\n    // 2. Xử lý trường hợp lỗi (Status không phải 2xx)\n    if (!response.ok) {\n      var _responseData;\n      // Tạo object lỗi để ném ra catch\n      const errorObj = new Error(((_responseData = responseData) === null || _responseData === void 0 ? void 0 : _responseData.message) || 'Fetch error');\n      errorObj.status = response.status; // <--- Gán thêm status vào lỗi để catch bắt được\n      errorObj.data = responseData; // Gán thêm data lỗi nếu cần\n      throw errorObj;\n    }\n\n    // 3. TRẢ VỀ CẢ DATA VÀ STATUS (Thành công)\n    return {\n      data: responseData,\n      // Dữ liệu từ backend\n      status: response.status // Mã HTTP (200, 201...)\n    };\n  }).catch(err => {\n    console.error(`Fetch ${method} error:`, err);\n    throw err;\n  });\n}\n\n// --- Các hàm Export để sử dụng bên ngoài ---\n\n// 1. GET (Giữ lại logic cũ của bạn nhưng gọi hàm request)\nexport function fetchModel(url) {\n  return request(url, 'GET');\n}\n\n// 2. POST (Tạo mới)\nexport function postModel(url, data) {\n  return request(url, 'POST', data);\n}\n\n// 3. PUT (Cập nhật)\nexport function putModel(url, data) {\n  return request(url, 'PUT', data);\n}\n\n// 4. DELETE (Xóa)\nexport function deleteModel(url) {\n  return request(url, 'DELETE');\n}\nexport default fetchModel;","map":{"version":3,"names":["BASE_URL","request","url","method","data","headers","config","credentials","body","JSON","stringify","fetch","then","response","responseData","json","e","ok","_responseData","errorObj","Error","message","status","catch","err","console","error","fetchModel","postModel","putModel","deleteModel"],"sources":["G:/ptit/kì 7/final/frontend-photo-sharing/src/lib/fetchModelData.js"],"sourcesContent":["const BASE_URL = 'http://localhost:8081';\r\n\r\nfunction request(url, method, data = null) {\r\n  const headers = {\r\n    'Content-Type': 'application/json',\r\n  };\r\n\r\n  const config = {\r\n    method: method,\r\n    headers: headers,\r\n    credentials: 'include', // Quan trọng: Cho phép gửi cookie session đi kèm\r\n  };\r\n\r\n  // Nếu có body và method không phải là GET/HEAD, thêm body vào config\r\n  if (data && method !== 'GET' && method !== 'HEAD') {\r\n    config.body = JSON.stringify(data);\r\n  }\r\n\r\n  return fetch(BASE_URL + url, config)\r\n    .then(async (response) => {\r\n      // 1. Cố gắng lấy data JSON, nếu backend không trả JSON (ví dụ lỗi 500 html) thì gán là null hoặc object rỗng\r\n      let responseData = null;\r\n      try {\r\n        responseData = await response.json();\r\n      } catch (e) {\r\n        responseData = null;\r\n      }\r\n\r\n      // 2. Xử lý trường hợp lỗi (Status không phải 2xx)\r\n      if (!response.ok) {\r\n        // Tạo object lỗi để ném ra catch\r\n        const errorObj = new Error(responseData?.message || 'Fetch error');\r\n        errorObj.status = response.status; // <--- Gán thêm status vào lỗi để catch bắt được\r\n        errorObj.data = responseData;      // Gán thêm data lỗi nếu cần\r\n        throw errorObj;\r\n      }\r\n\r\n      // 3. TRẢ VỀ CẢ DATA VÀ STATUS (Thành công)\r\n      return {\r\n        data: responseData,   // Dữ liệu từ backend\r\n        status: response.status // Mã HTTP (200, 201...)\r\n      };\r\n    })\r\n    .catch((err) => {\r\n      console.error(`Fetch ${method} error:`, err);\r\n      throw err;\r\n    });\r\n}\r\n\r\n// --- Các hàm Export để sử dụng bên ngoài ---\r\n\r\n// 1. GET (Giữ lại logic cũ của bạn nhưng gọi hàm request)\r\nexport function fetchModel(url) {\r\n  return request(url, 'GET');\r\n}\r\n\r\n// 2. POST (Tạo mới)\r\nexport function postModel(url, data) {\r\n  return request(url, 'POST', data);\r\n}\r\n\r\n// 3. PUT (Cập nhật)\r\nexport function putModel(url, data) {\r\n  return request(url, 'PUT', data);\r\n}\r\n\r\n// 4. DELETE (Xóa)\r\nexport function deleteModel(url) {\r\n  return request(url, 'DELETE');\r\n}\r\n\r\nexport default fetchModel;"],"mappings":"AAAA,MAAMA,QAAQ,GAAG,uBAAuB;AAExC,SAASC,OAAOA,CAACC,GAAG,EAAEC,MAAM,EAAEC,IAAI,GAAG,IAAI,EAAE;EACzC,MAAMC,OAAO,GAAG;IACd,cAAc,EAAE;EAClB,CAAC;EAED,MAAMC,MAAM,GAAG;IACbH,MAAM,EAAEA,MAAM;IACdE,OAAO,EAAEA,OAAO;IAChBE,WAAW,EAAE,SAAS,CAAE;EAC1B,CAAC;;EAED;EACA,IAAIH,IAAI,IAAID,MAAM,KAAK,KAAK,IAAIA,MAAM,KAAK,MAAM,EAAE;IACjDG,MAAM,CAACE,IAAI,GAAGC,IAAI,CAACC,SAAS,CAACN,IAAI,CAAC;EACpC;EAEA,OAAOO,KAAK,CAACX,QAAQ,GAAGE,GAAG,EAAEI,MAAM,CAAC,CACjCM,IAAI,CAAC,MAAOC,QAAQ,IAAK;IACxB;IACA,IAAIC,YAAY,GAAG,IAAI;IACvB,IAAI;MACFA,YAAY,GAAG,MAAMD,QAAQ,CAACE,IAAI,CAAC,CAAC;IACtC,CAAC,CAAC,OAAOC,CAAC,EAAE;MACVF,YAAY,GAAG,IAAI;IACrB;;IAEA;IACA,IAAI,CAACD,QAAQ,CAACI,EAAE,EAAE;MAAA,IAAAC,aAAA;MAChB;MACA,MAAMC,QAAQ,GAAG,IAAIC,KAAK,CAAC,EAAAF,aAAA,GAAAJ,YAAY,cAAAI,aAAA,uBAAZA,aAAA,CAAcG,OAAO,KAAI,aAAa,CAAC;MAClEF,QAAQ,CAACG,MAAM,GAAGT,QAAQ,CAACS,MAAM,CAAC,CAAC;MACnCH,QAAQ,CAACf,IAAI,GAAGU,YAAY,CAAC,CAAM;MACnC,MAAMK,QAAQ;IAChB;;IAEA;IACA,OAAO;MACLf,IAAI,EAAEU,YAAY;MAAI;MACtBQ,MAAM,EAAET,QAAQ,CAACS,MAAM,CAAC;IAC1B,CAAC;EACH,CAAC,CAAC,CACDC,KAAK,CAAEC,GAAG,IAAK;IACdC,OAAO,CAACC,KAAK,CAAC,SAASvB,MAAM,SAAS,EAAEqB,GAAG,CAAC;IAC5C,MAAMA,GAAG;EACX,CAAC,CAAC;AACN;;AAEA;;AAEA;AACA,OAAO,SAASG,UAAUA,CAACzB,GAAG,EAAE;EAC9B,OAAOD,OAAO,CAACC,GAAG,EAAE,KAAK,CAAC;AAC5B;;AAEA;AACA,OAAO,SAAS0B,SAASA,CAAC1B,GAAG,EAAEE,IAAI,EAAE;EACnC,OAAOH,OAAO,CAACC,GAAG,EAAE,MAAM,EAAEE,IAAI,CAAC;AACnC;;AAEA;AACA,OAAO,SAASyB,QAAQA,CAAC3B,GAAG,EAAEE,IAAI,EAAE;EAClC,OAAOH,OAAO,CAACC,GAAG,EAAE,KAAK,EAAEE,IAAI,CAAC;AAClC;;AAEA;AACA,OAAO,SAAS0B,WAAWA,CAAC5B,GAAG,EAAE;EAC/B,OAAOD,OAAO,CAACC,GAAG,EAAE,QAAQ,CAAC;AAC/B;AAEA,eAAeyB,UAAU","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}